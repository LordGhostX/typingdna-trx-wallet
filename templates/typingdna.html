{% extends "bootstrap/base.html" %}

{% block content %}
<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-12">
      <div class="jumbotron text-center p-4">
        <h2>Online TRON Cryptocurrency Wallet</h2>
        {% if action == "enroll" %}
        <p>Set TypingDNA 2FA on your online wallet</p>
        {% else %}
        <p>Verify your TypingDNA 2FA to access your online wallet</p>
        {% endif %}
      </div>
    </div>
    <div class="col-lg-6 text-center">
      <div class="alert alert-success" role="alert">
        <h4 class="alert-heading">TypingDNA 2FA Authentication</h4>
        <hr>
        <p class="mb-0"><strong>"I am authenticated by the way I type"</strong></p>
      </div>
      <div id="failed-auth" class="alert alert-danger alert-dismissible fade show" role="alert" style="display: none">
        <strong>An error occurred during authentication, please refresh the page to start again
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
      </div>
      <form method="POST">
        <div class="form-group">
          <label>Enter the text above without quotes to complete the authentication process</label>
          <input type="text" class="form-control">
        </div>
        <div class="form-group">
          <label>Enter the text one more time</label>
          <input type="text" class="form-control">
        </div>
        <div class="text-center">
          <input type="hidden" id="typing-pattern" name="typing-pattern">
          <button type="button" class="btn btn-success" onclick="startAuthentication()">Start Authentication</button>
        </div>
      </form>
    </div>
  </div>
</div>
<script src="{{ url_for('static', filename='typingdna.js') }}">
</script>
<script>
  var tdna = new TypingDNA();

  function startAuthentication() {
    TypingDNA.stop()
    let typingPattern = tdna.getTypingPattern({
      type: 1,
      text: "I am authenticated by the way I type"
    });
    if (typingPattern == null) {
      document.getElementById("failed-auth").style.display = "block";
    } else {
      document.getElementById("typing-pattern").value = typingPattern;
      document.forms[0].submit();
    }
  }
</script>
{% endblock %}